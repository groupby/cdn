!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).GBIEventCounter=t()}(this,(function(){"use strict";let e,t=[];const o=e=>(t.push(e),()=>{t=t.filter((t=>t!==e))}),n=e=>{const o=window.location;t.forEach((t=>{t(o,e)}))},s=()=>(e||(window.addEventListener("popstate",(()=>n("popstate"))),window.history.pushState=new Proxy(window.history.pushState,{apply:function(e,t,o){return n("pushState"),Reflect.apply(e,t,o)}}),e={subscribe:o}),e);let a,r,i,l;const c=e=>{const{customerId:t,listenToPushState:o,overrideUrl:n}=e;r=t,l=o??!1,i=n??"https://www.gbi-not-defined.com";a={trackEvent:e=>{console.log("customerId:",r),console.log("listenToPushState:",l),console.log("url:",i),console.log("eventType:",(null==e?void 0:e.type)??"-"),console.log("metadata:",(null==e?void 0:e.metadata)?"metadata exists":"-"),(async(e,t)=>{const{customerId:o,url:n}=t;try{return(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer:o,event:e})})).json()}catch(e){throw new Error((null==e?void 0:e.message)??"Error sending event")}})({type:(null==e?void 0:e.type)??"other",metadata:(null==e?void 0:e.metadata)??{message:`Sending an event... for "${r}" customer`}},{customerId:r,url:i})}},o&&s().subscribe(((e,t)=>{null==a||a.trackEvent({type:"location-changed",metadata:{location:e,source:t}})}))};return{registerGBIUniversalEventTracker:e=>(a||c(e),a)}}));
