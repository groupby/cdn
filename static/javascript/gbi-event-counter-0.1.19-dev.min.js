!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).GBIEventCounter=t()}(this,(function(){"use strict";let e,t=[];const o=e=>(t.push(e),()=>{t=t.filter((t=>t!==e))}),n=e=>{const o=window.location;t.forEach((t=>{t(o,e)}))},r=()=>(e||(window.addEventListener("popstate",(()=>n("popstate"))),window.history.pushState=new Proxy(window.history.pushState,{apply:function(e,t,o){return n("pushState"),Reflect.apply(e,t,o)}}),e={subscribe:o}),e);let s,a,i,l;const c=e=>{const{customerId:t,listenToPushState:o,overrideUrl:n}=e;a=t,l=o??!1,i=n??"https://www.gbi-not-defined.com";s={trackEvent:e=>{console.log("customerId:",a),console.log("listenToPushState:",l),console.log("url:",i),console.log("eventType:",(null==e?void 0:e.type)??"-"),console.log("metadata:",(null==e?void 0:e.metadata)?"metadata exists":"-"),(async(e,t)=>{const{customerId:o,url:n}=t;try{return(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer:o,event:e})})).json()}catch(e){throw new Error((null==e?void 0:e.message)??"Error sending event")}})({type:(null==e?void 0:e.type)??"other",metadata:(null==e?void 0:e.metadata)??{message:`Sending an event... for "${a}" customer`}},{customerId:a,url:i})}},o&&r().subscribe(((e,t)=>{null==s||s.trackEvent({type:"location-changed",metadata:{location:e,source:t}})}))};return{registerGBIUniversalEventTracker:e=>(s||c(e),s),getInstance:()=>{if(!s)throw new Error('Not initialized! Make sure you already called "register" function.');return s}}}));
